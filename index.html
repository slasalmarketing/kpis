<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KPI Tasks Logger</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body{font-family:"Cairo",Tahoma,Arial; background:#f4f6fa; color:#111; padding:20px}
  .card{max-width:1000px;margin:20px auto;background:#fff;border-radius:16px;
        box-shadow:0 4px 20px rgba(0,0,0,.08);padding:24px}
  h2{margin-top:0;text-align:center;color:#2c3e50}
  table{width:100%;border-collapse:collapse;margin-top:15px}
  th,td{border:1px solid #e0e6ed;padding:10px;text-align:center}
  th{background:#f9fafc;color:#34495e;font-weight:600}
  tr:nth-child(even){background:#fafbfd}
  input,select{padding:6px 10px;border:1px solid #ccc;border-radius:8px}
  .btn{padding:8px 14px;border:none;border-radius:8px;cursor:pointer;font-weight:600}
  .btn-add{background:#3498db;color:#fff}
  .btn-add:hover{background:#2980b9}
  .btn-pdf{background:#27ae60;color:#fff;margin-top:10px}
  .btn-pdf:hover{background:#1e8449}
  .delete-btn{background:none;border:none;cursor:pointer;font-size:18px;color:#e74c3c;transition:.2s}
  .delete-btn:hover{transform:scale(1.2);color:#c0392b}
  .summary{margin-top:20px;padding:15px;background:#ecf0f1;border-radius:12px;line-height:1.8}
  .highlight{color:#27ae60;font-weight:bold}
</style>
</head>
<body>
  <div class="card">
    <h2>âš™ï¸ Ù†Ø¸Ø§Ù… KPI + Ø§Ù„Ø¨ÙˆÙ†Øµ</h2>
    
    <label>ğŸ’° Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø«Ø§Ø¨Øª (Ø´Ù‡Ø±ÙŠ): </label>
    <input type="number" id="salary" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§ØªØ¨" />
    <label>ğŸ Ø£ÙŠØ§Ù… Ø§Ù„Ø¨ÙˆÙ†Øµ: </label>
    <input type="number" id="bonusDays" value="0" />
    <button class="btn btn-add" onclick="calculateAll()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø¨Ø©</button>

    <table id="taskTable">
      <thead>
        <tr>
          <th>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th>ğŸ‘¤ Ø§Ù„Ù…ÙˆØ¸Ù</th>
          <th>âš™ï¸ Ù†ÙˆØ¹ Ø§Ù„ØªØ§Ø³Ùƒ</th>
          <th>ğŸ“‘ Ø§Ù„Ø¹Ø¯Ø¯</th>
          <th>ğŸ§® Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button class="btn btn-add" onclick="addTask()"><i class="fa fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªØ§Ø³Ùƒ</button>

    <div class="summary" id="summaryBox">
      ğŸ’µ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: <span id="baseSalary">0</span> Ø±ÙŠØ§Ù„ <br>
      ğŸ“‘ Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ§Ø³ÙƒØ§Øª: <span id="tasksValue">0</span> Ø±ÙŠØ§Ù„ <br>
      ğŸ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨ÙˆÙ†Øµ: <span id="bonusValue">0</span> Ø±ÙŠØ§Ù„ <br>
      ğŸ§¾ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ: <span class="highlight" id="totalSalary">0</span> Ø±ÙŠØ§Ù„
    </div>

    <button class="btn btn-pdf" onclick="downloadPDF()"><i class="fa fa-file-pdf"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± PDF</button>
  </div>

<script>
let employeesList = [];
const API_URL = "https://script.google.com/macros/s/AKfycbw9i4FiqgqzRYq_iXpPFqWopF_m7yK7IPFGDfQjPnts4vmwKt8kRYwSg4OkRhpdYyY2/exec"; // ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆÙŠØ¨ Ø§Ø¨

// ğŸŸ¢ Ø¬Ù„Ø¨ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù…Ù† Google Sheet API
async function fetchEmployees() {
  try {
    let res = await fetch(API_URL);
    employeesList = await res.json();
  } catch (err) {
    console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:", err);
    employeesList = ["Ù…ÙˆØ¸Ù 1","Ù…ÙˆØ¸Ù 2"]; // fallback
  }
}

// ğŸŸ¢ Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
async function addTask(){
  if (employeesList.length === 0) {
    await fetchEmployees(); // Ù†ØªØ£ÙƒØ¯ Ø§Ù† Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§ØªØ³Ø­Ø¨Øª
  }
  let table=document.querySelector("#taskTable tbody");
  let row=document.createElement("tr");
  row.innerHTML=`
    <td><input type="date"></td>
    <td>
      <select>
        ${employeesList.map(name => `<option value="${name}">${name}</option>`).join("")}
      </select>
    </td>
    <td>
      <select>
        <option value="salla">Ø³Ù„Ø©</option>
        <option value="zid">Ø²Ø¯</option>
        <option value="shopify">Ø´ÙˆØ¨ÙŠÙØ§ÙŠ</option>
        <option value="wordpress">ÙˆÙˆØ±Ø¯Ø¨Ø±ÙŠØ³</option>
        <option value="opencart">Ø£ÙˆØ¨ ÙƒØ§Ø±Øª</option>
        <option value="coding">ÙƒÙˆØ¯ÙŠÙ†Ø¬</option>
        <option value="ui_shopify">UI Ø´ÙˆØ¨ÙŠÙØ§ÙŠ</option>
        <option value="other">Ù…Ù†ØµØ© Ø§Ø®Ø±Ù‰</option>
      </select>
    </td>
    <td><input type="number" min="1" value="1"></td>
    <td><button class="delete-btn" onclick="this.closest('tr').remove(); calculateAll()">
      <i class="fa-solid fa-trash"></i>
    </button></td>`;
  table.appendChild(row);
}

// ğŸŸ¢ Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ§Ø³Ùƒ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
function getTaskValue(type){
  let base = 0.25; // Ø³Ù„Ø© = 0.25 ÙŠÙˆÙ…
  if(type==="wordpress" || type==="opencart" || type==="ui_shopify"){
    return base*2;
  } else if(type==="coding"){
    return base*3;
  }
  return base;
}

// ğŸŸ¢ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ
function calculateAll(){
  let salary=parseFloat(document.getElementById("salary").value)||0;
  let bonusDays=parseInt(document.getElementById("bonusDays").value)||0;
  let daily=salary/30;

  let rows = document.querySelectorAll("#taskTable tbody tr");
  let totalTaskDays=0;
  rows.forEach(row=>{
    let type=row.querySelector("td:nth-child(3) select").value;
    let count=parseInt(row.querySelector("td:nth-child(4) input").value)||0;
    totalTaskDays += getTaskValue(type)*count;
  });
  let tasksValue = totalTaskDays * daily;
  let bonusValue = daily*bonusDays;
  let total = salary + tasksValue + bonusValue;

  document.getElementById("baseSalary").textContent=salary.toFixed(2);
  document.getElementById("tasksValue").textContent=tasksValue.toFixed(2);
  document.getElementById("bonusValue").textContent=bonusValue.toFixed(2);
  document.getElementById("totalSalary").textContent=total.toFixed(2);
}

// ğŸŸ¢ ØªØ­Ù…ÙŠÙ„ PDF
function downloadPDF(){
  const { jsPDF } = window.jspdf;
  let doc = new jsPDF("p","pt","a4");

  doc.setFont("Helvetica","bold");
  doc.setFontSize(16);
  doc.text("ØªÙ‚Ø±ÙŠØ± KPI + Ø§Ù„Ø¨ÙˆÙ†Øµ", 220, 40);

  doc.setFontSize(12);
  doc.setFont("Helvetica","normal");

  let salary=document.getElementById("baseSalary").textContent;
  let tasks=document.getElementById("tasksValue").textContent;
  let bonus=document.getElementById("bonusValue").textContent;
  let total=document.getElementById("totalSalary").textContent;

  doc.text(`ğŸ’µ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: ${salary} Ø±ÙŠØ§Ù„`, 60, 80);
  doc.text(`ğŸ“‘ Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ§Ø³ÙƒØ§Øª: ${tasks} Ø±ÙŠØ§Ù„`, 60, 100);
  doc.text(`ğŸ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨ÙˆÙ†Øµ: ${bonus} Ø±ÙŠØ§Ù„`, 60, 120);
  doc.text(`ğŸ§¾ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ: ${total} Ø±ÙŠØ§Ù„`, 60, 140);

  let rows = document.querySelectorAll("#taskTable tbody tr");
  let startY = 180;
  doc.setFont("Helvetica","bold");
  doc.text("ğŸ“‘ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ§Ø³ÙƒØ§Øª:", 60, startY);
  doc.setFont("Helvetica","normal");
  startY += 20;

  rows.forEach((row,i)=>{
    let cols = row.querySelectorAll("td");
    let date = cols[0].querySelector("input").value;
    let name = cols[1].querySelector("select").value;
    let type = cols[2].querySelector("select").value;
    let count = cols[3].querySelector("input").value;
    doc.text(`${i+1}- ${date} | ${name} | ${type} | Ø§Ù„Ø¹Ø¯Ø¯: ${count}`, 60, startY);
    startY += 20;
  });

  doc.save("KPI_Report.pdf");
}

// ğŸŸ¢ ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
window.onload = fetchEmployees;
</script>
</body>
</html>
